#!/bin/bash
#
#                           Ezanvakti YAD Arayüz 1 Bileşeni 2.2
#
#
#set -x

. @libdir@/@AD@/temel_islevler.bash
. @libdir@/@AD@/arayuz_temel.bash

# Yalnızca bir arayüz örneği çalışması için
# pid denetimi yapılsın. (arayuz_temel.bash)
arayuz_pid_denetle 1

bilesen_yukle oynatici_yonetici
bilesen_yukle hicri

elx=''
for ((i=1; i<=ARAYUZ_CIZGI_UZUNLUGU; i++))
do
  elx+="${ARAYUZ_CIZGI_SIMGESI}"
done

arayuz() {
  local strng donus str str2 sure sure_sifirli oynatici_ileti secim_basligi
  g_vakitleri_al; gun_animsat h

strng=$(yad --form --text "$(printf "${GELISMIS_ARAYUZ_BICIMI}" \
  "<span foreground=\'${ARAYUZ_TARIH_SAAT_RENGI}\'>$(date +%d.%m.%Y) \($(hicri_tarih_al)\)</span>" \
  "<span foreground=\'${ARAYUZ_TARIH_SAAT_RENGI}\'>$(date +%T)</span>" \
  "<span foreground=\'${ARAYUZ_KONUM_RENGI}\'>${ILCE} / ${ULKE}</span>" \
  "<span foreground=\'${ARAYUZ_CIZGI_RENGI}\'>${elx}</span>" \
  "<span foreground=\'${ARAYUZ_SIMDIKI_VAKIT_RENGI}\'>${vakit_bilgisi}${ozel_ileti}</span>" \
  "<span foreground=\'${ARAYUZ_CIZGI_RENGI}\'>${elx}</span>" "$(g_vakitleri_yaz)" \
  "<span foreground=\'${ARAYUZ_KALAN_SURE_RENGI}\'>${v_ileti}</span>" \
  "<span foreground=\'${ARAYUZ_KALAN_SURE_RENGI}\'>${v_kalan}</span>")" \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Ezanlar</span>:CB" \
'!Sabah!Öğle!İkindi!Akşam!Yatsı!Sela' \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Sureler</span>:CB" \
"!000-Özel Pencere$sure_listesi" \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Seçimler</span>:CB" \
${secim_listesi} \
--field="<span foreground=\'${ARAYUZ_SECKE_ADLARI_RENGI}\'>Başlatıcı</span>:CE" \
"${tamamlama_listesi}" --button='yad-ok:150' --button="yad-close:121" \
${simge_goster} --window-icon=${AD} --title "${AD^}" --center --fixed --gtkrc="${EZV_CSS}")

donus=$(echo $?)

declare -x $(echo "$strng" | sed 's:|: :g' | gawk '{print "str="$1 "\nstr2="$2}')

[[ -n $str2 ]] && arayuz

if (( donus == 150 ))
then
    case "$str" in
    "Sabah")
        oynatici_ileti=" Sabah ezanı dinletiliyor\n\n Okuyan : ${EZAN_OKUYAN}"
        pencere_bilgi "${SABAH_EZANI}" & oynatici_calistir "${SABAH_EZANI}"
        arayuz ;;
    "Öğle")
        oynatici_ileti=" Öğle ezanı dinletiliyor\n\n Okuyan : ${EZAN_OKUYAN}"
        pencere_bilgi "${OGLE_EZANI}" & oynatici_calistir "${OGLE_EZANI}"
        arayuz ;;
    "İkindi")
        oynatici_ileti=" İkindi ezanı dinletiliyor\n\n Okuyan : ${EZAN_OKUYAN}"
        pencere_bilgi "$IKINDI_EZANI" & oynatici_calistir "${IKINDI_EZANI}"
        arayuz ;;
    "Akşam")
        oynatici_ileti=" Akşam ezanı dinletiliyor\n\n Okuyan : ${EZAN_OKUYAN}"
        pencere_bilgi "${AKSAM_EZANI}" & oynatici_calistir "${AKSAM_EZANI}"
        arayuz ;;
    "Yatsı")
        oynatici_ileti=" Yatsı ezanı dinletiliyor\n\n Okuyan : ${EZAN_OKUYAN}"
        pencere_bilgi "${YATSI_EZANI}" & oynatici_calistir "${YATSI_EZANI}"
        arayuz ;;
    "Sela")
        oynatici_ileti=" Cuma selası dinletiliyor\n\n Okuyan : ${SELA_OKUYAN}"
        pencere_bilgi "${CUMA_SELASI}" & oynatici_calistir "${CUMA_SELASI}"
        arayuz ;;
    "Ayet")
        secim_basligi='Günlük Ayet'
        bilesen_yukle ayet_goster
        ayet_goster ucbirim > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    "Hadis")
        secim_basligi='40 Hadis'
        bilesen_yukle bilgi_goster
        hadis_goster ucbirim > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    "Esma-ül Hüsna")
        secim_basligi='Esma-ül Hüsna'
        bilesen_yukle bilgi_goster
        esma_goster ucbirim > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    "Bilgi")
        secim_basligi='Dini Bilgiler'
        bilesen_yukle bilgi_goster
        bilgi_goster ucbirim > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    "Günlük Vakitler")
        secim_basligi='Günlük Vakitler'
        bilesen_yukle vakitleri_goster
        vakitler tum_vakitler > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    "Aylık Vakitler")
        secim_basligi='Aylık Vakitler'
        bilesen_yukle vakitleri_goster
        vakitler aylik > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    "Haftalık Vakitler")
        secim_basligi='Haftalık Vakitler'
        bilesen_yukle vakitleri_goster
        vakitler haftalik > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    Kerahat*)
        secim_basligi='Kerahat Vakitleri'
        bilesen_yukle kerahat
        kerahat_vakitleri ucbirim > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
#     "Bayram Namazı Vakitleri")
#         secim_basligi="$(date +%Y) Bayram namazı vakitleri"
#         bilesen_yukle bayram_namazi
#         (
#           echo 'yad gürültü istiyor'
#           bayram_namazi_vakti > "${cikti_dosyasi}"
#           echo 'yad gürültü istiyor'
#           sed -i 's:.*\.\.\.::g' "${cikti_dosyasi}"
#           echo 'yad gürültü istiyor'
#         ) | yad --progress --pulsate --auto-close --undecorated \
#                 --progress-text='Bayram namazı vakitleri alınıyor...' \
#                 --pulsate --auto-close --width=300 --center --fixed \
#                 --no-buttons --skip-taskbar
#         g_secim_goster; temizlik
#         arayuz ;;
    "Dini Günler ve Geceler")
        secim_basligi="$(date +%Y) Dini Günler ve Geceler"
        bilesen_yukle dini_gunler
        gunler > "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;

#     elif [[ $str = Son Cuma Hutbesini indir ]]
#     then
#         bilesen_yukle cuma_hutbesi
#         hutbe_indir
#         arayuz
#
#     elif [[ $str = Cuma Hutbelerini listele ]]
#     then
#         bilesen_yukle cuma_hutbesi
#         hutbe_indir listele
#         arayuz

    Ayarlar|yapilandirma|Yapılandırma Yöneticisi)
        bilesen_yukle yapilandirma_yoneticisi
        yapilandirma ;;
    "özel pencere")
        ozel_pencere ;;
    "güncelle")
        bilesen_yukle guncelleyici
        gorsel_guncelleme_yap
        arayuz ;;
    "güncelle yeni")
        bilesen_yukle guncelleyici
        gorsel_guncelleme_yap yenile
        arayuz ;;
    hakkında|about)
        bilesen_yukle hakkinda
        g_hakkinda; arayuz ;;
    yardım)
        bilesen_yukle kullanim
        betik_kullanimi > "${cikti_dosyasi}"
        sed -i '$d' "${cikti_dosyasi}"
        g_secim_goster; temizlik
        arayuz ;;
    [0-9]*-*)
        sure=$(cut -d'-' -f1 <<<$str)

        if [[ $sure = 000 ]]
        then
            ozel_pencere
        else
            # $sure değerini denetleyip
            # sure_kod değişkenine atayacak. (temel_islevler.bash)
            sure_no_denetle "$sure"
            # okuyan, kaynak, dinletilecek_sure
            # değerlerini bu fonksiyon gönderiyor. (temel_islevler.bash)
            kuran_okuyan_denetle "$sure_kod"
        fi

        bilesen_yukle kuran_dinletici
        oynatici_ileti="$(gawk -v sira=$sure '{if(NR==sira) print $4;}' < ${VERI_DIZINI}/veriler/sure_bilgisi)"
        oynatici_ileti+=" suresi dinletiliyor\n\n Okuyan : ${okuyan}"

        pencere_bilgi "${dinletilecek_sure}" &
        kuran_dinlet secim $sure
        arayuz ;;
    *)
        arayuz ;;
    esac

elif (( donus == 121 ))
then
    exit 0
fi
}; arayuz

# vim: set ft=sh ts=2 sw=2 et:
